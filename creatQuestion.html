<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Tr√¨nh t·∫°o b·ªô c√¢u h·ªèi JSON</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: sans-serif;
        background: #f8fafc;
        color: #111;
        padding: 20px;
        max-width: 850px;
        margin: auto;
      }
      h1 {
        text-align: center;
      }
      input,
      textarea,
      button,
      select {
        padding: 8px;
        margin: 4px 0;
        width: 100%;
        font-size: 15px;
      }
      .question-block {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      }
      .answers {
        margin-left: 10px;
      }
      button {
        cursor: pointer;
        border: none;
        background: #2563eb;
        color: white;
        border-radius: 8px;
        padding: 8px 12px;
      }
      button:hover {
        background: #1d4ed8;
      }
      .danger {
        background: #dc2626;
      }
      .danger:hover {
        background: #b91c1c;
      }
      .secondary {
        background: #6b7280;
      }
      .secondary:hover {
        background: #4b5563;
      }
      .toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
      }
      #fileInput {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>üß† T·∫°o & Ch·ªânh s·ª≠a B·ªô C√¢u H·ªèi JSON</h1>

    <div id="creator">
      <label>C√¢u h·ªèi (t√πy ch·ªçn):</label>
      <textarea
        id="question"
        rows="2"
        placeholder="Nh·∫≠p n·ªôi dung c√¢u h·ªèi (c√≥ th·ªÉ b·ªè tr·ªëng)..."
      ></textarea>

      <label>ƒê∆∞·ªùng d·∫´n h√¨nh (m·∫∑c ƒë·ªãnh ./image/...):</label>
      <input
        id="urlImage"
        placeholder="1.jpg ho·∫∑c ./image/1.jpg"
        oninput="if(!this.value.startsWith('./image/')) this.value = './image/' + this.value.replace('./image/','')"
      />

      <div class="answers">
        <h3>ƒê√°p √°n:</h3>
        <div id="answers">
          <input placeholder="ƒê√°p √°n 1" class="answer" />
          <input placeholder="ƒê√°p √°n 2" class="answer" />
          <input placeholder="ƒê√°p √°n 3" class="answer" />
          <input placeholder="ƒê√°p √°n 4" class="answer" />
        </div>
        <label>Ch·ªçn ƒë√°p √°n ƒë√∫ng (1‚Äì4):</label>
        <input type="number" id="correct" min="1" max="4" value="1" />
      </div>

      <button id="add">‚ûï Th√™m c√¢u h·ªèi</button>
    </div>

    <hr />

    <h2>B·ªô c√¢u h·ªèi hi·ªán t·∫°i</h2>
    <div id="questionList"></div>

    <div class="toolbar">
      <button id="download">‚¨áÔ∏è T·∫£i file JSON</button>
      <button id="upload" class="secondary">üì§ T·∫£i l√™n file JSON</button>
      <input type="file" id="fileInput" accept=".json" />
      <button id="clear" class="danger">üóëÔ∏è X√≥a to√†n b·ªô</button>
    </div>

    <script>
      const questionListEl = document.getElementById("questionList");
      const fileInput = document.getElementById("fileInput");
      const storageKey = "quizData";
      let data = JSON.parse(localStorage.getItem(storageKey)) || [];

      function saveToLocal() {
        localStorage.setItem(storageKey, JSON.stringify(data, null, 4));
      }

      // --- Hi·ªÉn th·ªã danh s√°ch c√¢u h·ªèi ---
      function renderList() {
        questionListEl.innerHTML = "";
        if (data.length === 0) {
          questionListEl.innerHTML = "<i>Ch∆∞a c√≥ c√¢u h·ªèi n√†o...</i>";
          return;
        }
        data.forEach((q, i) => {
          const div = document.createElement("div");
          div.className = "question-block";
          div.innerHTML = `
                    <b>${i + 1}. ${
            q.question || "(Kh√¥ng c√≥ n·ªôi dung c√¢u h·ªèi)"
          }</b><br>
                    <small>·∫¢nh: ${q.urlImage || "(Kh√¥ng c√≥)"}</small><br>
                    <ul>
                        ${q.answers
                          .map(
                            (a, idx) =>
                              `<li ${
                                a.correct
                                  ? 'style="color:green;font-weight:bold"'
                                  : ""
                              }>
                                        ${idx + 1}. ${a.answer}
                                    </li>`
                          )
                          .join("")}
                    </ul>
                `;
          questionListEl.appendChild(div);
        });
      }
      renderList();

      // --- Th√™m c√¢u h·ªèi ---
      document.getElementById("add").onclick = () => {
        const question = document.getElementById("question").value.trim();
        let urlImage = document.getElementById("urlImage").value.trim();

        if (urlImage && !urlImage.startsWith("./image/")) {
          urlImage = "./image/" + urlImage;
        }

        const correctIndex =
          parseInt(document.getElementById("correct").value) - 1;

        const answers = Array.from(document.querySelectorAll(".answer")).map(
          (el, i) => ({
            answer: el.value.trim(),
            correct: i === correctIndex,
          })
        );

        if (answers.some((a) => !a.answer)) {
          alert("Vui l√≤ng nh·∫≠p ƒë·ªß 4 ƒë√°p √°n.");
          return;
        }

        const newQuestion = {
          numberOrder: data.length + 1,
          question: question || "",
          urlImage: urlImage || "",
          answers,
        };
        data.push(newQuestion);
        saveToLocal();
        renderList();

        // Reset form
        document.getElementById("question").value = "";
        document.getElementById("urlImage").value = "";
        document.querySelectorAll(".answer").forEach((a) => (a.value = ""));
      };

      // --- T·∫£i xu·ªëng file JSON ---
      document.getElementById("download").onclick = () => {
        if (data.length === 0) {
          alert("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i xu·ªëng!");
          return;
        }
        const blob = new Blob([JSON.stringify(data, null, 4)], {
          type: "application/json",
        });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "quizData.json";
        a.click();
      };

      // --- X√≥a to√†n b·ªô ---
      document.getElementById("clear").onclick = () => {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu?")) {
          data = [];
          localStorage.removeItem(storageKey);
          renderList();
        }
      };

      // --- T·∫£i l√™n file JSON ---
      document.getElementById("upload").onclick = () => fileInput.click();

      fileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const imported = JSON.parse(event.target.result);
            if (!Array.isArray(imported)) throw new Error("File kh√¥ng h·ª£p l·ªá!");
            if (confirm("Th√™m d·ªØ li·ªáu t·ª´ file n√†y v√†o danh s√°ch hi·ªán c√≥?")) {
              data = data.concat(imported);
            } else {
              data = imported;
            }
            saveToLocal();
            renderList();
            alert("‚úÖ ƒê√£ t·∫£i file JSON th√†nh c√¥ng!");
          } catch (err) {
            alert("‚ùå L·ªói: File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng JSON.");
          }
        };
        reader.readAsText(file);
        e.target.value = "";
      });
    </script>
  </body>
</html>
